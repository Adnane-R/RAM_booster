####################
# Global Variables #
####################

#/boot and / of the Original OS
ROOT_UUID=$(cat /var/lib/ram_booster/conf | grep ROOT_UUID= | sed 's/ROOT_UUID=//g')
BOOT_UUID=$(cat /var/lib/ram_booster/conf | grep BOOT_UUID= | sed 's/BOOT_UUID=//g')
DEST=$(cat /var/lib/ram_booster/conf | grep DEST= | sed 's/DEST=//g')
#Remove leading slash from $DEST
DEST="${DEST#/}"
Orig_OS='/mnt/Original_OS'

#Mount $DEST (RAM Session)
MOUNT_RS()
{
	#If the $Orig_OS folder exists, check if
	#anything is using it as a mount point
	if [[ -d "$Orig_OS" ]]
	then
		#If something is mounted, return with an error
		if mountpoint -q "$Orig_OS"
		then
			echo "Failed to mount RAM Session. Is it already mounted?"
			return 1
		fi

		#Try to remove the $Orig_OS
		sudo rmdir "$Orig_OS" &>/dev/null

		#If removing the $Orig_OS folder fails, like if it's
		#not empty, return with an error
		if [[ "$?" != "0" ]]
		then
			echo "Failed to remove old $Orig_OS folder."
			echo "Does it have files in it?"
			return 1
		fi
	fi

	#Make Orig_OS folder
	sudo mkdir -p "$Orig_OS"

	#Try to mount $ROOT_UUID to $Orig_OS
	sudo mount --uuid $ROOT_UUID "$Orig_OS" &>/dev/null ||
	{
		echo "Failed to mount $ROOT_UUID $Orig_OS"
		UMOUNT_RS
		return 1
	}
	
	#Bind /proc
	sudo mount -o bind /proc "$Orig_OS/$DEST/proc" ||
	{
		echo "Failed to bind /proc to ${Orig_OS%/}/${DEST%/}/proc"
		UMOUNT_RS
		return 1
	}

	#Bind /dev
	sudo mount -o bind /dev "$Orig_OS/$DEST/dev" ||
	{
		echo "Failed to bind /dev to ${Orig_OS%/}/${DEST%/}/dev"
		UMOUNT_RS
		return 1
	}

	#Bind /dev/pts
	sudo mount -o bind /dev/pts "$Orig_OS/$DEST/dev/pts" ||
	{
		echo "Failed to bind /dev/pts to ${Orig_OS%/}/${DEST%/}/dev/pts"
		UMOUNT_RS
		return 1
	}

	#Bind /sys
	sudo mount -o bind /sys "$Orig_OS/$DEST/sys" ||
	{
		echo "Failed to bind /sys to ${Orig_OS%/}/${DEST%/}/sys"
		UMOUNT_RS
		return 1
	}

	#Bind /run
	sudo mount -o bind /run "$Orig_OS/$DEST/run" ||
	{
		echo "Failed to bind /run to ${Orig_OS%/}/${DEST%/}/run"
		UMOUNT_RS
		return 1
	}
	
	#Bind /home

}

#Unmount $DEST (RAM Session)
UMOUNT_RS()
{
	echo "Unmounting"
}
